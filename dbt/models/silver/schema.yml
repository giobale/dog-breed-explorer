# ABOUTME: Schema definitions and tests for silver layer intermediate models
# ABOUTME: Ensures data quality through comprehensive testing on parsed and normalized breed data

version: 2

models:
  - name: int_dog_breeds_parsed
    description: >
      Intermediate model that extracts structured fields from the raw JSON breed data.
      Parses essential breed attributes including identifiers, name, temperament,
      life span, and weight into separate columns for downstream processing.

    columns:
      - name: row_id
        description: Unique row identifier from the source table
        tests:
          - not_null

      - name: _dlt_id
        description: Unique identifier generated by dlt for record tracking
        tests:
          - not_null
          - unique

      - name: _dlt_load_id
        description: dlt pipeline load identifier for traceability
        tests:
          - not_null

      - name: breed_id
        description: Unique identifier for the breed from the Dog API
        tests:
          - not_null
          - unique

      - name: breed_name
        description: Name of the dog breed
        tests:
          - not_null

      - name: temperament
        description: Personality and behavioral traits of the breed
        tests:
          - not_null

      - name: life_span
        description: Life span range as string (e.g., "10 - 12 years")
        tests:
          - not_null

      - name: weight_kg
        description: Weight range in metric units (kg) as string
        tests:
          - not_null

      - name: ingested_at
        description: Timestamp when the record was ingested into the raw layer
        tests:
          - not_null

      - name: dbt_run_at
        description: Timestamp when this dbt model was executed
        tests:
          - not_null

  - name: int_dog_breeds_normalized
    description: >
      Intermediate model that extracts maximum life span in years from the
      life_span string field. Provides normalized numeric life span data
      for analytical queries and aggregations.

    columns:
      - name: row_id
        description: Unique row identifier from the source table
        tests:
          - not_null

      - name: _dlt_id
        description: Unique identifier generated by dlt for record tracking
        tests:
          - not_null
          - unique

      - name: _dlt_load_id
        description: dlt pipeline load identifier for traceability
        tests:
          - not_null

      - name: breed_id
        description: Unique identifier for the breed
        tests:
          - not_null
          - unique

      - name: breed_name
        description: Name of the dog breed
        tests:
          - not_null

      - name: temperament
        description: Personality and behavioral traits of the breed
        tests:
          - not_null

      - name: life_span
        description: Life span range as string (e.g., "10 - 12 years")
        tests:
          - not_null

      - name: weight_kg
        description: Weight range in metric units (kg) as string
        tests:
          - not_null

      - name: life_span_max_years
        description: Maximum life span in years extracted from life_span string
        tests:
          - not_null

      - name: ingested_at
        description: Timestamp when the record was ingested into the raw layer
        tests:
          - not_null

      - name: dbt_run_at
        description: Timestamp when this dbt model was executed
        tests:
          - not_null
